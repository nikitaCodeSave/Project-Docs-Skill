# ADR-001: Технологический стек

**Статус:** Accepted
**Дата:** 2024-01-15
**Связь с SPEC:** FR-1, FR-2, NFR-1

## Контекст

Необходимо определить технологический стек для локального сервиса транскрипции с diarization, word-level timestamps.

**Движущие факторы:**
- WER < 10% (требование PRD)
- Время обработки ≤ 0.5x длины аудио (NFR-1)
- Минимальная сложность интеграции
- Работа офлайн

**Ограничения:**
- Consumer GPU (8-10 GB VRAM)
- Open-source решения

## Решения

### Язык: Python 3.10+

**Обоснование:**
- WhisperX и ML-экосистема требуют Python
- Богатая экосистема аудио-обработки (pydub, soundfile)
- Простота интеграции с CLI (Click, Typer)

**Альтернативы не рассматривались** — выбор языка предопределён зависимостью от WhisperX.

### STT Engine: WhisperX

**Рассмотренные варианты:**

#### Вариант 1: OpenAI Whisper

| Критерий | Оценка |
|----------|--------|
| Качество | + Отличное |
| Diarization | - Нет |
| Скорость | - Медленный |

#### Вариант 2: Whisper + pyannote (раздельно)

| Критерий | Оценка |
|----------|--------|
| Качество | + Отличное |
| Diarization | + Есть |
| Интеграция | - Сложная |

#### Вариант 3: WhisperX

| Критерий | Оценка |
|----------|--------|
| Качество | + Отличное |
| Diarization | + Встроенный |
| Скорость | + 70x realtime |
| Интеграция | + Единый pipeline |

**Выбран WhisperX:**
- Batched inference критичен для NFR-1
- Единый pipeline снижает сложность
- 19k+ stars, активное сообщество

### Audio Processing: ffmpeg

**Обоснование:**
- Де-факто стандарт для работы с аудио
- Поддержка всех требуемых форматов (MP3, WAV, FLAC, M4A, OGG)
- Установлен на большинстве систем

**Альтернативы не рассматривались** — ffmpeg является индустриальным стандартом.

## Последствия

### Положительные
- Быстрый старт разработки
- Меньше кода интеграции
- Единый pipeline для transcription + diarization

### Отрицательные
- Зависимость от pyannote (требует HuggingFace token)
- Ограниченный контроль над diarization
- Python runtime требует управления зависимостями

### Риски
- Breaking changes в WhisperX — митигация: фиксация версии в requirements.txt
- Проблемы совместимости CUDA — митигация: документирование поддерживаемых версий
