# SPEC: Audio Transcription Service

## Обзор
Сервис транскрипции аудио в текст с автоматическим определением спикеров. Работает локально, поддерживает batch-обработку.

## Глоссарий

| Термин | Определение |
|--------|-------------|
| Транскрипция | Преобразование речи в текст |
| Diarization | Разделение аудио по спикерам |
| WER | Word Error Rate — % ошибочных слов |
| Сегмент | Непрерывный фрагмент речи одного спикера |

## Допущения
- Аудио содержит речь (не музыку)
- Качество записи достаточное (SNR > 10 dB)
- Спикеров от 1 до 10
- Язык: русский или английский

## Функциональные требования

### FR-1: Транскрипция аудио

**Связь с PRD:** G1

Система принимает аудиофайл и возвращает текст с временными метками.

**Acceptance Criteria:**
```gherkin
AC-1.1:
GIVEN аудиофайл 10 минут
WHEN транскрипция
THEN результат содержит сегменты с start, end, text
AND сегменты упорядочены по времени

AC-1.2:
GIVEN файл в формате MP3|WAV|FLAC|M4A|OGG
WHEN транскрипция
THEN успешная обработка

AC-1.3:
GIVEN повреждённый файл
WHEN транскрипция
THEN понятное сообщение об ошибке
AND exit code != 0
```

---

### FR-2: Разделение спикеров

**Связь с PRD:** G2

Система определяет разных спикеров и помечает сегменты.

**Acceptance Criteria:**
```gherkin
AC-2.1:
GIVEN аудио с 2+ голосами
WHEN транскрипция с diarization
THEN каждый сегмент имеет speaker ID
AND разные голоса — разные ID

AC-2.2:
GIVEN любой файл
WHEN --no-diarize
THEN сегменты без speaker ID
```

---

### FR-3: Форматы вывода

**Связь с PRD:** G1

Поддержка: JSON, TXT, SRT

**Acceptance Criteria:**
```gherkin
AC-3.1:
GIVEN завершённая транскрипция
WHEN -f json,srt,txt
THEN создаются 3 файла с соответствующими расширениями
```

---

### FR-4: Batch-обработка

**Связь с PRD:** G4

**Acceptance Criteria:**
```gherkin
AC-4.1:
GIVEN директория с 5 файлами
WHEN batch
THEN 5 результатов
AND прогресс выводится

AC-4.2:
GIVEN 5 файлов, 1 повреждён
WHEN batch
THEN 4 успешно, 1 ошибка залогирована
```

## Нефункциональные требования

### NFR-1: Производительность
| Метрика | Требование | Условия |
|---------|------------|---------|
| Время обработки | ≤ 0.5x длины | GPU, large-v3 |
| Время обработки | ≤ 5x длины | CPU only |

### NFR-2: Качество
| Метрика | Требование |
|---------|------------|
| WER | < 10% (чистая речь) |
| Diarization | > 85% (2-5 спикеров) |

### NFR-3: Ресурсы
| Ресурс | Требование |
|--------|------------|
| GPU VRAM | 8-10 GB |
| RAM | 16 GB рекомендуется |

### NFR-4: Автономность
- Работа без интернета после установки
- Модели хранятся локально

## Ограничения системы
- Не real-time
- Не идентифицирует спикеров по имени
- Overlapping speech — ограниченная точность

## Вне рамок v1.0
- Web-интерфейс
- REST API
- Custom model training
